const profile=document.querySelector(".profile");let userId=null,year=null;function getUserId(){const e=document.querySelector(".current h1");null!==e&&(userId=e.dataset.id)}function getYear(){const e=document.querySelector(".yearHeader");null!==e&&(year=e.dataset.year)}function updateProfile(e){if(removeSpinnerIfPresent(),null!==e.logs||0!==e.events.length)null!==e.logs&&printLogs(e.logs),0!==e.events.length&&printEvents(e.events);else{const e=createNotification();profile.appendChild(e)}}function printLogs(e){const t=document.createElement("section");t.classList.add("table");const n=document.createElement("table"),d=document.createElement("thead"),a=document.createElement("tr"),o=document.createElement("th");o.classList.add("icon");const c=document.createElement("th");c.appendChild(document.createTextNode("Level")),c.classList.add("level");const s=document.createElement("th");s.appendChild(document.createTextNode("Experience"));const i=document.createElement("th");i.appendChild(document.createTextNode("Difference"));const r=document.createElement("tbody");profile.appendChild(t),t.appendChild(n),n.appendChild(d),a.appendChild(o),a.appendChild(c),a.appendChild(s),a.appendChild(i),d.appendChild(a),n.appendChild(r),e.forEach(function(e,t){const n=document.createElement("tr"),d=document.createElement("td"),a=document.createElement("span");a.classList.add("log-icon","s"+t),d.appendChild(a);const o=document.createElement("td");o.appendChild(document.createTextNode(e.lg_level));const c=document.createElement("td");c.appendChild(document.createTextNode(Math.round(e.lg_value).toLocaleString()));const s=document.createElement("td");e.difference>0?(s.appendChild(document.createTextNode("+"+Math.round(e.difference).toLocaleString())),s.classList.add("log-value","positive")):s.appendChild(document.createTextNode("0")),n.appendChild(d),n.appendChild(o),n.appendChild(c),n.appendChild(s),r.appendChild(n)})}function printEvents(e){const t=document.createElement("section");t.classList.add("events");const n=document.createElement("ul");n.classList.add("events"),profile.appendChild(t),t.appendChild(n),e.forEach(function(e,t){const d=document.createElement("li");d.classList.add("event-item");const a=document.createElement("div");a.classList.add("event-header");const o=document.createElement("h2");o.appendChild(document.createTextNode(e.ev_title)),o.classList.add("event-title");const c=document.createElement("span");c.appendChild(document.createTextNode(dayjs.unix(e.ev_ts).format("MMMM D, YYYY HH:mm"))),c.classList.add("event-timestamp");const s=document.createElement("p");s.appendChild(document.createTextNode(e.ev_details)),s.classList.add("event-details"),d.appendChild(a),a.appendChild(o),a.appendChild(c),d.appendChild(s),n.appendChild(d)})}function createNotification(){const e=document.createElement("div");e.classList.add("text","notification","inf");const t=document.createElement("h2");t.appendChild(document.createTextNode("Nothing interesting happened."));const n=document.createElement("p");return n.appendChild(document.createTextNode("Looks like we don't have any data for you on this day.")),e.appendChild(t),e.appendChild(n),e}const body=document.querySelector("body");let isNightmode=body.classList.contains("is-nightmode");const nightmodeToggle=document.querySelector(".night-mode-toggle");function toggleNightmodeOnClick(e){e.preventDefault(),isNightmode=!(isNightmode=body.classList.contains("is-nightmode")),body.classList.toggle("is-nightmode"),localStorage.setItem("nightmode",JSON.stringify(isNightmode))}function turnOnNightmodeOnPageLoad(){"true"===localStorage.getItem("nightmode")&&body.classList.toggle("is-nightmode")}let startDay,endDay;null!==nightmodeToggle&&nightmodeToggle.addEventListener("click",toggleNightmodeOnClick);let dragged=!1;const gridSquares=document.querySelectorAll(".day");function gridStartHandler(e){startDay=e.target.dataset.index,document.querySelectorAll(".today").forEach(function(e,t){e.classList.toggle("today")}),document.querySelectorAll(".select").forEach(function(e,t){e.classList.toggle("select")}),e.target.classList.toggle("today"),dragged=!0}function gridEndHandler(e){e.preventDefault(),endDay=e.target.dataset.index,dragged=!1,startDay>endDay?load(endDay,startDay):load(startDay,endDay)}function gridHoverHandler(e){dragged&&gridSquares.forEach(function(t,n){t.classList.remove("select"),parseInt(startDay)>parseInt(e.target.dataset.index)?parseInt(t.dataset.index)<=parseInt(startDay)&&parseInt(t.dataset.index)>=parseInt(e.target.dataset.index)&&t.classList.add("select"):parseInt(t.dataset.index)>=parseInt(startDay)&&parseInt(t.dataset.index)<=parseInt(e.target.dataset.index)&&t.classList.add("select")})}function removeSpinnerIfPresent(){const e=document.querySelector(".spinner");null!==e&&e.remove()}function removeNotificationIfPresent(){const e=document.querySelector(".notification");null!==e&&e.remove()}function load(e,t){const n={userId:userId,year:year,startDay:e,endDay:t};profile.innerHTML="",removeNotificationIfPresent(),removeSpinnerIfPresent();const d=document.createElement("span");d.classList.add("spinner"),profile.appendChild(d);const a=new XMLHttpRequest;a.open("POST","/api/getData",!0),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.send(JSON.stringify(n)),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&updateProfile(JSON.parse(a.responseText))}}gridSquares.length>0&&gridSquares.forEach(function(e,t){["mousedown","touchstart"].forEach(function(t){e.addEventListener(t,gridStartHandler)}),["mouseup","touchend"].forEach(function(t){e.addEventListener(t,gridEndHandler)}),["mouseenter","touchenter"].forEach(function(t){e.addEventListener(t,gridHoverHandler)})}),getUserId(),getYear(),turnOnNightmodeOnPageLoad();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJwcm9maWxlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidXNlcklkIiwieWVhciIsImdldFVzZXJJZCIsInVzZXJIZWFkZXIiLCJkYXRhc2V0IiwiaWQiLCJnZXRZZWFyIiwieWVhckhlYWRlciIsInVwZGF0ZVByb2ZpbGUiLCJkYXRhIiwicmVtb3ZlU3Bpbm5lcklmUHJlc2VudCIsImxvZ3MiLCJldmVudHMiLCJsZW5ndGgiLCJwcmludExvZ3MiLCJwcmludEV2ZW50cyIsIm5vdGlmaWNhdGlvbiIsImNyZWF0ZU5vdGlmaWNhdGlvbiIsImFwcGVuZENoaWxkIiwibG9nU2VjdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJsb2dUYWJsZSIsImxvZ0hlYWRlciIsImxvZ0hlYWRlclJvdyIsImxvZ0hlYWRlckljb24iLCJsb2dIZWFkZXJMZXZlbCIsImNyZWF0ZVRleHROb2RlIiwibG9nSGVhZGVyRXhwZXJpZW5jZSIsImxvZ0hlYWRlckRpZmZlcmVuY2UiLCJsb2dUYWJsZUJvZHkiLCJmb3JFYWNoIiwibG9nIiwiaW5kZXgiLCJsb2dSb3ciLCJsb2dJY29uQ2VsbCIsImxvZ0ljb24iLCJsb2dMZXZlbCIsImxnX2xldmVsIiwibG9nVmFsdWUiLCJNYXRoIiwicm91bmQiLCJsZ192YWx1ZSIsInRvTG9jYWxlU3RyaW5nIiwibG9nRGlmZmVyZW5jZSIsImRpZmZlcmVuY2UiLCJldmVudFNlY3Rpb24iLCJldmVudExpc3QiLCJldmVudCIsImV2ZW50SXRlbSIsImV2ZW50SGVhZGVyIiwiZXZlbnRUaXRsZSIsImV2X3RpdGxlIiwiZXZlbnRUaW1lc3RhbXAiLCJkYXlqcyIsInVuaXgiLCJldl90cyIsImZvcm1hdCIsImV2ZW50RGV0YWlscyIsImV2X2RldGFpbHMiLCJub3RpZmljYXRpb25UaXRsZSIsIm5vdGlmaWNhdGlvblRleHQiLCJib2R5IiwiaXNOaWdodG1vZGUiLCJjb250YWlucyIsIm5pZ2h0bW9kZVRvZ2dsZSIsInRvZ2dsZU5pZ2h0bW9kZU9uQ2xpY2siLCJlIiwicHJldmVudERlZmF1bHQiLCJ0b2dnbGUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsInR1cm5Pbk5pZ2h0bW9kZU9uUGFnZUxvYWQiLCJnZXRJdGVtIiwic3RhcnREYXkiLCJlbmREYXkiLCJhZGRFdmVudExpc3RlbmVyIiwiZHJhZ2dlZCIsImdyaWRTcXVhcmVzIiwicXVlcnlTZWxlY3RvckFsbCIsImdyaWRTdGFydEhhbmRsZXIiLCJ0YXJnZXQiLCJzcXVhcmUiLCJncmlkRW5kSGFuZGxlciIsImxvYWQiLCJncmlkSG92ZXJIYW5kbGVyIiwicmVtb3ZlIiwicGFyc2VJbnQiLCJzcGlubmVyIiwicmVtb3ZlTm90aWZpY2F0aW9uSWZQcmVzZW50IiwiaW5uZXJIVE1MIiwibmV3U3Bpbm5lciIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInBhcnNlIiwicmVzcG9uc2VUZXh0Il0sIm1hcHBpbmdzIjoiQUFZQSxNQUFNQSxRQUFVQyxTQUFTQyxjQUFjLFlBQ3ZDLElBQUlDLE9BQVMsS0FDVEMsS0FBTyxLQUVYLFNBQVNDLFlBQ0wsTUFBTUMsRUFBYUwsU0FBU0MsY0FBYyxlQUN2QixPQUFmSSxJQUNBSCxPQUFTRyxFQUFXQyxRQUFRQyxJQUlwQyxTQUFTQyxVQUNMLE1BQU1DLEVBQWFULFNBQVNDLGNBQWMsZUFDdkIsT0FBZlEsSUFDQU4sS0FBT00sRUFBV0gsUUFBUUgsTUFJbEMsU0FBU08sY0FBY0MsR0FJbkIsR0FGQUMseUJBRW1CLE9BQWZELEVBQUtFLE1BQTBDLElBQXhCRixFQUFLRyxPQUFPQyxPQU1wQixPQUFmSixFQUFLRSxNQUNMRyxVQUFVTCxFQUFLRSxNQUdTLElBQXhCRixFQUFLRyxPQUFPQyxRQUNaRSxZQUFZTixFQUFLRyxZQVhy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Y0FBYyxpQkFDdkIsT0FBakJpQixHQUNBQSxFQUFheUUsU0FJckIsU0FBU0YsS0FBS1YsRUFBVUMsR0FHcEIsTUFBTXJFLEVBQU8sQ0FDVFQsT0FBUUEsT0FDUkMsS0FBTUEsS0FDTjRFLFNBQVVBLEVBQ1ZDLE9BQVFBLEdBSVpqRixRQUFRZ0csVUFBWSxHQUNwQkQsOEJBQ0FsRix5QkFHQSxNQUFNb0YsRUFBYWhHLFNBQVNzQixjQUFjLFFBQzFDMEUsRUFBV3pFLFVBQVVDLElBQUksV0FDekJ6QixRQUFRcUIsWUFBWTRFLEdBR3BCLE1BQU1DLEVBQU0sSUFBSUMsZUFDaEJELEVBQUlFLEtBQUssT0FBUSxnQkFBZ0IsR0FDakNGLEVBQUlHLGlCQUFpQixlQUFnQixtQ0FDckNILEVBQUlJLEtBQUsxQixLQUFLQyxVQUFVakUsSUFDeEJzRixFQUFJSyxtQkFBcUIsV0FDRSxJQUFuQkwsRUFBSU0sWUFBbUMsTUFBZk4sRUFBSU8sUUFDNUI5RixjQUFjaUUsS0FBSzhCLE1BQU1SLEVBQUlTLGdCQTFHckN2QixZQUFZcEUsT0FBUyxHQUVyQm9FLFlBQVlqRCxRQUFRLFNBQVVxRCxFQUFRbkQsR0FFbEMsQ0FBQyxZQUFhLGNBQWNGLFFBQVEsU0FBVW9DLEdBQzFDaUIsRUFBT04saUJBQWlCWCxFQUFHZSxvQkFHL0IsQ0FBQyxVQUFXLFlBQVluRCxRQUFRLFNBQVVvQyxHQUN0Q2lCLEVBQU9OLGlCQUFpQlgsRUFBR2tCLGtCQUcvQixDQUFDLGFBQWMsY0FBY3RELFFBQVEsU0FBVW9DLEdBQzNDaUIsRUFBT04saUJBQWlCWCxFQUFHb0Isc0JBMEd2Q3RGLFlBQ0FJLFVBQ0FxRSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBSdW5lbG9ncyBzY3JpcHQuanNcbiAqXG4gKiBDb250ZW50OlxuICogIC0gR2V0IHVzZXJJZCBhbmQgY3VycmVudCB5ZWFyIGZyb20gdGhlIGFwcHJvcHJpYXRlIGhlYWRlcnNcbiAqICAtIEdyaWQgc3F1YXJlIGNsaWNrIGV2ZW50IC0+IFhoUiByZXF1ZXN0IG5hYXIgQVBJIC0+IHVwZGF0ZSBwcm9maWxlXG4gKiAgLSBOaWdodG1vZGUgdG9nZ2xlICh3b3JrcyB3aXRoIGxvY2FsU3RvcmFnZSlcbiAqICAtIEdyaWQgZHJhZyAtPiBzZWxlY3Qgc3F1YXJlc1xuICogIC0gUHJpbnQgYSB0YWJsZSB3aXRoIHJvd3MgZm9yIGV4cCBvciBhbiB1bm9yZGVuZWQgbG9zdCBmb3IgZXZlbnRzXG4gKlxuICovXG5cbmNvbnN0IHByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZScpO1xubGV0IHVzZXJJZCA9IG51bGw7XG5sZXQgeWVhciA9IG51bGw7XG5cbmZ1bmN0aW9uIGdldFVzZXJJZCgpIHtcbiAgICBjb25zdCB1c2VySGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmN1cnJlbnQgaDEnKTtcbiAgICBpZiAodXNlckhlYWRlciAhPT0gbnVsbCkge1xuICAgICAgICB1c2VySWQgPSB1c2VySGVhZGVyLmRhdGFzZXQuaWQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRZZWFyKCkge1xuICAgIGNvbnN0IHllYXJIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcueWVhckhlYWRlcicpO1xuICAgIGlmICh5ZWFySGVhZGVyICE9PSBudWxsKSB7XG4gICAgICAgIHllYXIgPSB5ZWFySGVhZGVyLmRhdGFzZXQueWVhcjtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVByb2ZpbGUoZGF0YSlcbntcbiAgICByZW1vdmVTcGlubmVySWZQcmVzZW50KCk7XG5cbiAgICBpZiAoZGF0YS5sb2dzICA9PT0gbnVsbCAmJiBkYXRhLmV2ZW50cy5sZW5ndGggID09PSAwKSB7XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGNyZWF0ZU5vdGlmaWNhdGlvbigpO1xuICAgICAgICBwcm9maWxlLmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvbik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5sb2dzICAhPT0gbnVsbCkge1xuICAgICAgICBwcmludExvZ3MoZGF0YS5sb2dzKTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5ldmVudHMubGVuZ3RoICAhPT0gMCkge1xuICAgICAgICBwcmludEV2ZW50cyhkYXRhLmV2ZW50cyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwcmludExvZ3MobG9ncylcbntcbiAgICAvLyBQcmludCB0aGUgZXhwZXJpZW5jZSB0YWJsZSBhbmQgaGVhZGVyXG4gICAgY29uc3QgbG9nU2VjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlY3Rpb24nKTtcbiAgICBsb2dTZWN0aW9uLmNsYXNzTGlzdC5hZGQoJ3RhYmxlJyk7XG5cbiAgICBjb25zdCBsb2dUYWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG4gICAgY29uc3QgbG9nSGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKTtcblxuICAgIGNvbnN0IGxvZ0hlYWRlclJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBsb2dIZWFkZXJJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICBsb2dIZWFkZXJJY29uLmNsYXNzTGlzdC5hZGQoJ2ljb24nKTtcblxuICAgIGNvbnN0IGxvZ0hlYWRlckxldmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICBsb2dIZWFkZXJMZXZlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTGV2ZWwnKSk7XG4gICAgbG9nSGVhZGVyTGV2ZWwuY2xhc3NMaXN0LmFkZCgnbGV2ZWwnKTtcblxuICAgIGNvbnN0IGxvZ0hlYWRlckV4cGVyaWVuY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xuICAgIGxvZ0hlYWRlckV4cGVyaWVuY2UuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0V4cGVyaWVuY2UnKSk7XG5cbiAgICBjb25zdCBsb2dIZWFkZXJEaWZmZXJlbmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICBsb2dIZWFkZXJEaWZmZXJlbmNlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdEaWZmZXJlbmNlJykpO1xuXG4gICAgY29uc3QgbG9nVGFibGVCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTtcblxuICAgIHByb2ZpbGUuYXBwZW5kQ2hpbGQobG9nU2VjdGlvbik7XG4gICAgbG9nU2VjdGlvbi5hcHBlbmRDaGlsZChsb2dUYWJsZSk7XG4gICAgbG9nVGFibGUuYXBwZW5kQ2hpbGQobG9nSGVhZGVyKTtcblxuICAgIGxvZ0hlYWRlclJvdy5hcHBlbmRDaGlsZChsb2dIZWFkZXJJY29uKTtcbiAgICBsb2dIZWFkZXJSb3cuYXBwZW5kQ2hpbGQobG9nSGVhZGVyTGV2ZWwpO1xuICAgIGxvZ0hlYWRlclJvdy5hcHBlbmRDaGlsZChsb2dIZWFkZXJFeHBlcmllbmNlKTtcbiAgICBsb2dIZWFkZXJSb3cuYXBwZW5kQ2hpbGQobG9nSGVhZGVyRGlmZmVyZW5jZSk7XG5cbiAgICBsb2dIZWFkZXIuYXBwZW5kQ2hpbGQobG9nSGVhZGVyUm93KTtcblxuICAgIGxvZ1RhYmxlLmFwcGVuZENoaWxkKGxvZ1RhYmxlQm9keSk7XG5cbiAgICAvKiBEaXNwbGF5IHRoZSBleHBlcmllbmNlIHRhYmxlIHJvd3MgKi9cbiAgICBsb2dzLmZvckVhY2goZnVuY3Rpb24gKGxvZywgaW5kZXgpIHtcblxuICAgICAgICBjb25zdCBsb2dSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgICAgIGNvbnN0IGxvZ0ljb25DZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgICAgY29uc3QgbG9nSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgbG9nSWNvbi5jbGFzc0xpc3QuYWRkKCdsb2ctaWNvbicsICdzJyArIGluZGV4KTtcbiAgICAgICAgbG9nSWNvbkNlbGwuYXBwZW5kQ2hpbGQobG9nSWNvbik7XG5cbiAgICAgICAgY29uc3QgbG9nTGV2ZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICBsb2dMZXZlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsb2cubGdfbGV2ZWwpKTtcblxuICAgICAgICBjb25zdCBsb2dWYWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIGxvZ1ZhbHVlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKE1hdGgucm91bmQobG9nLmxnX3ZhbHVlKS50b0xvY2FsZVN0cmluZygpKSk7XG5cbiAgICAgICAgY29uc3QgbG9nRGlmZmVyZW5jZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIGlmIChsb2cuZGlmZmVyZW5jZSA+IDApIHtcbiAgICAgICAgICAgIGxvZ0RpZmZlcmVuY2UuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJysnICsgTWF0aC5yb3VuZChsb2cuZGlmZmVyZW5jZSkudG9Mb2NhbGVTdHJpbmcoKSkpO1xuICAgICAgICAgICAgbG9nRGlmZmVyZW5jZS5jbGFzc0xpc3QuYWRkKCdsb2ctdmFsdWUnLCAncG9zaXRpdmUnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ0RpZmZlcmVuY2UuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJzAnKSk7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dSb3cuYXBwZW5kQ2hpbGQobG9nSWNvbkNlbGwpO1xuICAgICAgICBsb2dSb3cuYXBwZW5kQ2hpbGQobG9nTGV2ZWwpO1xuICAgICAgICBsb2dSb3cuYXBwZW5kQ2hpbGQobG9nVmFsdWUpO1xuICAgICAgICBsb2dSb3cuYXBwZW5kQ2hpbGQobG9nRGlmZmVyZW5jZSk7XG4gICAgICAgIGxvZ1RhYmxlQm9keS5hcHBlbmRDaGlsZChsb2dSb3cpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBwcmludEV2ZW50cyhldmVudHMpXG57XG4gICAgY29uc3QgZXZlbnRTZWN0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VjdGlvbicpO1xuICAgIGV2ZW50U2VjdGlvbi5jbGFzc0xpc3QuYWRkKCdldmVudHMnKTtcblxuICAgIGNvbnN0IGV2ZW50TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG4gICAgZXZlbnRMaXN0LmNsYXNzTGlzdC5hZGQoJ2V2ZW50cycpO1xuXG4gICAgcHJvZmlsZS5hcHBlbmRDaGlsZChldmVudFNlY3Rpb24pO1xuICAgIGV2ZW50U2VjdGlvbi5hcHBlbmRDaGlsZChldmVudExpc3QpO1xuXG4gICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50LCBpbmRleCkge1xuXG4gICAgICAgIGNvbnN0IGV2ZW50SXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgIGV2ZW50SXRlbS5jbGFzc0xpc3QuYWRkKCdldmVudC1pdGVtJyk7XG5cbiAgICAgICAgY29uc3QgZXZlbnRIZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZXZlbnRIZWFkZXIuY2xhc3NMaXN0LmFkZCgnZXZlbnQtaGVhZGVyJyk7XG5cbiAgICAgICAgY29uc3QgZXZlbnRUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgICAgIGV2ZW50VGl0bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZXZlbnQuZXZfdGl0bGUpKTtcbiAgICAgICAgZXZlbnRUaXRsZS5jbGFzc0xpc3QuYWRkKCdldmVudC10aXRsZScpO1xuXG4gICAgICAgIGNvbnN0IGV2ZW50VGltZXN0YW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBldmVudFRpbWVzdGFtcC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXlqcy51bml4KGV2ZW50LmV2X3RzKS5mb3JtYXQoXCJNTU1NIEQsIFlZWVkgSEg6bW1cIikpKTtcbiAgICAgICAgZXZlbnRUaW1lc3RhbXAuY2xhc3NMaXN0LmFkZCgnZXZlbnQtdGltZXN0YW1wJyk7XG5cbiAgICAgICAgY29uc3QgZXZlbnREZXRhaWxzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgICBldmVudERldGFpbHMuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZXZlbnQuZXZfZGV0YWlscykpO1xuICAgICAgICBldmVudERldGFpbHMuY2xhc3NMaXN0LmFkZCgnZXZlbnQtZGV0YWlscycpO1xuXG4gICAgICAgIGV2ZW50SXRlbS5hcHBlbmRDaGlsZChldmVudEhlYWRlcik7XG4gICAgICAgIGV2ZW50SGVhZGVyLmFwcGVuZENoaWxkKGV2ZW50VGl0bGUpO1xuICAgICAgICBldmVudEhlYWRlci5hcHBlbmRDaGlsZChldmVudFRpbWVzdGFtcCk7XG4gICAgICAgIGV2ZW50SXRlbS5hcHBlbmRDaGlsZChldmVudERldGFpbHMpO1xuXG4gICAgICAgIGV2ZW50TGlzdC5hcHBlbmRDaGlsZChldmVudEl0ZW0pO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVOb3RpZmljYXRpb24oKVxue1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIG5vdGlmaWNhdGlvbi5jbGFzc0xpc3QuYWRkKCd0ZXh0JywgJ25vdGlmaWNhdGlvbicsICdpbmYnKTtcblxuICAgIGNvbnN0IG5vdGlmaWNhdGlvblRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgICBub3RpZmljYXRpb25UaXRsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIk5vdGhpbmcgaW50ZXJlc3RpbmcgaGFwcGVuZWQuXCIpKTtcblxuICAgIGNvbnN0IG5vdGlmaWNhdGlvblRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm90aWZpY2F0aW9uVGV4dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcIkxvb2tzIGxpa2Ugd2UgZG9uJ3QgaGF2ZSBhbnkgZGF0YSBmb3IgeW91IG9uIHRoaXMgZGF5LlwiKSk7XG5cbiAgICBub3RpZmljYXRpb24uYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uVGl0bGUpO1xuICAgIG5vdGlmaWNhdGlvbi5hcHBlbmRDaGlsZChub3RpZmljYXRpb25UZXh0KTtcbiAgICByZXR1cm4gbm90aWZpY2F0aW9uO1xufVxuXG4vKiBOaWdodG1vZGUgdG9nZ2xlIChnbG9iYWwpICovXG5cbmNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5sZXQgaXNOaWdodG1vZGUgPSBib2R5LmNsYXNzTGlzdC5jb250YWlucygnaXMtbmlnaHRtb2RlJyk7XG5jb25zdCBuaWdodG1vZGVUb2dnbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmlnaHQtbW9kZS10b2dnbGUnKTtcblxuZnVuY3Rpb24gdG9nZ2xlTmlnaHRtb2RlT25DbGljayhlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgLy8gR2V0IHRoZSBib2R5IGNsYXNzIGFuZCByZXZlcnNlIGl0XG4gICAgaXNOaWdodG1vZGUgPSBib2R5LmNsYXNzTGlzdC5jb250YWlucygnaXMtbmlnaHRtb2RlJyk7XG4gICAgaXNOaWdodG1vZGUgPSAhaXNOaWdodG1vZGU7XG5cbiAgICAvLyBTZXQgdGhlIGJvZHkgY2xhc3Mgc28gdGhhdCB0aGUgc3R5bGluZyBjaGFuZ2VzXG4gICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1uaWdodG1vZGUnKTtcblxuICAgIC8vIFN0b3JlIHRoZSBib29sIGluIGxvY2FsU3RvcmFnZVxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibmlnaHRtb2RlXCIsIEpTT04uc3RyaW5naWZ5KGlzTmlnaHRtb2RlKSk7XG59XG5cbi8qXG4gKiBJZiBhIHBhZ2UgaXMgbG9hZGVkIGFuZCB0aGUgbG9jYWxTdG9yYWdlIHBhcmFtZXRlciBpcyBzZXQgdG9cbiAqIHRydWUsIHRoZW4gc3dpdGNoIHRoZSBwYWdlIHN0eWxpbmdcbiAqL1xuZnVuY3Rpb24gdHVybk9uTmlnaHRtb2RlT25QYWdlTG9hZCgpIHtcbiAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJuaWdodG1vZGVcIikgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtbmlnaHRtb2RlJyk7XG4gICAgfVxufVxuXG5pZiAobmlnaHRtb2RlVG9nZ2xlICE9PSBudWxsKSB7XG4gICAgbmlnaHRtb2RlVG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlTmlnaHRtb2RlT25DbGljayk7XG59XG5cbi8qIERhdGUgY2xpY2tlciAqL1xubGV0IHN0YXJ0RGF5LCBlbmREYXk7XG5sZXQgZHJhZ2dlZCA9IGZhbHNlO1xuXG4vKiBTVkcgR3JpZCBldmVudHMgKi9cbmNvbnN0IGdyaWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRheScpO1xuXG4vLyBxdWVyeVNlbGVjdG9yQWxsIHJldHVybnMgYSBOb2RlbGlzdCBzbyBoYXZlIHRvIGNoZWNrIGZvciBsZW5ndGhcbmlmIChncmlkU3F1YXJlcy5sZW5ndGggPiAwKSB7XG5cbiAgICBncmlkU3F1YXJlcy5mb3JFYWNoKGZ1bmN0aW9uIChzcXVhcmUsIGluZGV4KSB7XG5cbiAgICAgICAgWydtb3VzZWRvd24nLCAndG91Y2hzdGFydCddLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKGUsIGdyaWRTdGFydEhhbmRsZXIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBbJ21vdXNldXAnLCAndG91Y2hlbmQnXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihlLCBncmlkRW5kSGFuZGxlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIFsnbW91c2VlbnRlcicsICd0b3VjaGVudGVyJ10uZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoZSwgZ3JpZEhvdmVySGFuZGxlcik7XG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdyaWRTdGFydEhhbmRsZXIoZSkge1xuICAgIHN0YXJ0RGF5ID0gZS50YXJnZXQuZGF0YXNldC5pbmRleDtcblxuICAgIGNvbnN0IGFjdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50b2RheScpO1xuICAgIGFjdGl2ZS5mb3JFYWNoKGZ1bmN0aW9uIChzcXVhcmUsIGluZGV4KSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QudG9nZ2xlKCd0b2RheScpO1xuICAgIH0pXG4gICAgY29uc3Qgc2VsZWN0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VsZWN0Jyk7XG4gICAgc2VsZWN0ZWQuZm9yRWFjaChmdW5jdGlvbiAoc3F1YXJlLCBpbmRleCkge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LnRvZ2dsZSgnc2VsZWN0Jyk7XG4gICAgfSlcbiAgICBlLnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCd0b2RheScpO1xuICAgIGRyYWdnZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBncmlkRW5kSGFuZGxlcihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGVuZERheSA9IGUudGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG4gICAgZHJhZ2dlZCA9IGZhbHNlO1xuICAgIGlmIChzdGFydERheSA+IGVuZERheSkge1xuICAgICAgICBsb2FkKGVuZERheSwgc3RhcnREYXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxvYWQoc3RhcnREYXksIGVuZERheSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBncmlkSG92ZXJIYW5kbGVyKGUpIHtcbiAgICBpZiAoZHJhZ2dlZCkge1xuICAgICAgICBncmlkU3F1YXJlcy5mb3JFYWNoKGZ1bmN0aW9uIChzcXVhcmUsIGluZGV4KSB7XG4gICAgICAgICAgICAvL3Jlc2V0XG4gICAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0Jyk7XG4gICAgICAgICAgICAvL3JpZ2h0IGRyYWdcbiAgICAgICAgICAgIGlmIChwYXJzZUludChzdGFydERheSkgPiBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LmluZGV4KSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChzcXVhcmUuZGF0YXNldC5pbmRleCkgPD0gcGFyc2VJbnQoc3RhcnREYXkpICYmIHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmluZGV4KSA+PSBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LmluZGV4KSkge1xuICAgICAgICAgICAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZCgnc2VsZWN0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL2xlZnQgZHJhZ1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChzcXVhcmUuZGF0YXNldC5pbmRleCkgPj0gcGFyc2VJbnQoc3RhcnREYXkpICYmIHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmluZGV4KSA8PSBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LmluZGV4KSkge1xuICAgICAgICAgICAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZCgnc2VsZWN0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlU3Bpbm5lcklmUHJlc2VudCgpIHtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNwaW5uZXInKTtcbiAgICBpZiAoc3Bpbm5lciAhPT0gbnVsbCkge1xuICAgICAgICBzcGlubmVyLnJlbW92ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlTm90aWZpY2F0aW9uSWZQcmVzZW50KCkge1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub3RpZmljYXRpb24nKTtcbiAgICBpZiAobm90aWZpY2F0aW9uICE9PSBudWxsKSB7XG4gICAgICAgIG5vdGlmaWNhdGlvbi5yZW1vdmUoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGxvYWQoc3RhcnREYXksIGVuZERheSkge1xuXG4gICAgLy8gIFByZXAgdGhlIGRhdGEgdGhhdCB0aGUgQVBJIG5lZWRzXG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgdXNlcklkOiB1c2VySWQsXG4gICAgICAgIHllYXI6IHllYXIsXG4gICAgICAgIHN0YXJ0RGF5OiBzdGFydERheSxcbiAgICAgICAgZW5kRGF5OiBlbmREYXlcbiAgICB9O1xuXG4gICAgLy8gIENsZWFuIHVwIHRoZSBwcm9maWxlIHNvIHdlIGNhbiByZS1pbnNlcnQgdGhlIG5ldyBkYXRhXG4gICAgcHJvZmlsZS5pbm5lckhUTUwgPSAnJztcbiAgICByZW1vdmVOb3RpZmljYXRpb25JZlByZXNlbnQoKTtcbiAgICByZW1vdmVTcGlubmVySWZQcmVzZW50KCk7XG5cbiAgICAvLyAgQWRkIHRoZSBsb2FkaW5nIHNwaW5uZXJcbiAgICBjb25zdCBuZXdTcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIG5ld1NwaW5uZXIuY2xhc3NMaXN0LmFkZCgnc3Bpbm5lcicpO1xuICAgIHByb2ZpbGUuYXBwZW5kQ2hpbGQobmV3U3Bpbm5lcik7XG5cbiAgICAvLyAgU3RhcnQgdGhlIHJlcXVlc3RcbiAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB4aHIub3BlbignUE9TVCcsICcvYXBpL2dldERhdGEnLCB0cnVlKTtcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnKTtcbiAgICB4aHIuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0ICYmIHhoci5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgdXBkYXRlUHJvZmlsZShKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLypcbmxldCBncmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQtY29udGFpbmVyJyk7XG5pZihncmlkKXtcbiAgbGV0IG1heCA9IGdyaWQuc2Nyb2xsV2lkdGggLSBncmlkLmNsaWVudFdpZHRoO1xuICBncmlkLnNjcm9sbExlZnQgPSBtYXg7XG59XG4qL1xuXG5nZXRVc2VySWQoKTtcbmdldFllYXIoKTtcbnR1cm5Pbk5pZ2h0bW9kZU9uUGFnZUxvYWQoKTsiXX0=