!function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(!t||"TABLE"!==t.tagName)throw new Error("Element must be a table");this.init(t,n||{})}var t=[],n=function(e){var t;return window.CustomEvent&&"function"==typeof window.CustomEvent?t=new CustomEvent(e):(t=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,void 0),t},o=function(e){return e.getAttribute("data-sort")||e.textContent||e.innerText||""},a=function(e,t){return(e=e.trim().toLowerCase())===(t=t.trim().toLowerCase())?0:e<t?1:-1},d=function(e,t){return function(n,o){var a=e(n.td,o.td);return 0===a?t?o.index-n.index:n.index-o.index:a}};e.extend=function(e,n,o){if("function"!=typeof n||"function"!=typeof o)throw new Error("Pattern and sort must be a function");t.push({name:e,pattern:n,sort:o})},e.prototype={init:function(e,t){var n,o,a,d,r=this;if(r.table=e,r.thead=!1,r.options=t,e.rows&&e.rows.length>0)if(e.tHead&&e.tHead.rows.length>0){for(a=0;a<e.tHead.rows.length;a++)if("thead"===e.tHead.rows[a].getAttribute("data-sort-method")){n=e.tHead.rows[a];break}n||(n=e.tHead.rows[e.tHead.rows.length-1]),r.thead=!0}else n=e.rows[0];if(n){var i=function(){r.current&&r.current!==this&&r.current.removeAttribute("aria-sort"),r.current=this,r.sortTable(this)};for(a=0;a<n.cells.length;a++)(d=n.cells[a]).setAttribute("role","columnheader"),"none"!==d.getAttribute("data-sort-method")&&(d.tabindex=0,d.addEventListener("click",i,!1),null!==d.getAttribute("data-sort-default")&&(o=d));o&&(r.current=o,r.sortTable(o))}},sortTable:function(e,r){var i=this,s=e.cellIndex,c=a,l="",u=[],p=i.thead?0:1,m=e.getAttribute("data-sort-method"),h=e.getAttribute("aria-sort");if(i.table.dispatchEvent(n("beforeSort")),r||(h="ascending"===h?"descending":"descending"===h?"ascending":i.options.descending?"descending":"ascending",e.setAttribute("aria-sort",h)),!(i.table.rows.length<2)){if(!m){for(;u.length<3&&p<i.table.tBodies[0].rows.length;)(l=(l=o(i.table.tBodies[0].rows[p].cells[s])).trim()).length>0&&u.push(l),p++;if(!u)return}for(p=0;p<t.length;p++)if(l=t[p],m){if(l.name===m){c=l.sort;break}}else if(u.every(l.pattern)){c=l.sort;break}for(i.col=s,p=0;p<i.table.tBodies.length;p++){var f,g=[],v={},y=0,E=0;if(!(i.table.tBodies[p].rows.length<2)){for(f=0;f<i.table.tBodies[p].rows.length;f++)"none"===(l=i.table.tBodies[p].rows[f]).getAttribute("data-sort-method")?v[y]=l:g.push({tr:l,td:o(l.cells[i.col]),index:y}),y++;for("descending"===h?g.sort(d(c,!0)):(g.sort(d(c,!1)),g.reverse()),f=0;f<y;f++)v[f]?(l=v[f],E++):l=g[f-E].tr,i.table.tBodies[p].appendChild(l)}}i.table.dispatchEvent(n("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=e:window.Tablesort=e}(),function(){var e=function(e){return e.replace(/[^\-?0-9.]/g,"")};Tablesort.extend("number",function(e){return e.match(/^[-+]?[£\x24Û¢´€]?\d+\s*([,\.]\d{0,2})/)||e.match(/^[-+]?\d+\s*([,\.]\d{0,2})?[£\x24Û¢´€]/)||e.match(/^[-+]?(\d)*-?([,\.]){0,1}-?(\d)+([E,e][\-+][\d]+)?%?$/)},function(t,n){return t=e(t),function(e,t){return e=parseFloat(e),t=parseFloat(t),(e=isNaN(e)?0:e)-(t=isNaN(t)?0:t)}(n=e(n),t)})}();const profile=document.querySelector(".profile");let userId=null,year=null;function getUserId(){const e=document.querySelector(".current h1");null!==e&&(userId=e.dataset.id)}function getYear(){const e=document.querySelector(".yearHeader");null!==e&&(year=e.dataset.year)}function updateProfile(e){if(console.table(e),removeSpinnerIfPresent(),null!==e.logs||0!==e.events.length)null!==e.logs&&printLogs(e.logs),0!==e.events.length&&printEvents(e.events);else{const e=createNotification();profile.appendChild(e)}}function printLogs(e){const t=document.createElement("section");t.classList.add("table");const n=document.createElement("table"),o=document.createElement("thead"),a=document.createElement("tr"),d=document.createElement("th");d.classList.add("icon");const r=document.createElement("th");r.appendChild(document.createTextNode("Level")),r.classList.add("level");const i=document.createElement("th");i.appendChild(document.createTextNode("Experience"));const s=document.createElement("th");s.appendChild(document.createTextNode("Difference"));const c=document.createElement("tbody");profile.appendChild(t),t.appendChild(n),n.appendChild(o),a.appendChild(d),a.appendChild(r),a.appendChild(i),a.appendChild(s),o.appendChild(a),n.appendChild(c),e.forEach(function(e,t){const n=document.createElement("tr"),o=document.createElement("td"),a=document.createElement("span");a.classList.add("log-icon","s"+t),o.appendChild(a);const d=document.createElement("td");d.appendChild(document.createTextNode(e.level));const r=document.createElement("td");r.appendChild(document.createTextNode(Math.round(e.value).toLocaleString()));const i=document.createElement("td");e.difference>0?(i.appendChild(document.createTextNode("+"+Math.round(e.difference).toLocaleString())),i.classList.add("log-value","positive")):i.appendChild(document.createTextNode("0")),n.appendChild(o),n.appendChild(d),n.appendChild(r),n.appendChild(i),c.appendChild(n)})}function printEvents(e){const t=document.createElement("section");t.classList.add("events");const n=document.createElement("ul");n.classList.add("events"),profile.appendChild(t),t.appendChild(n),e.forEach(function(e,t){const o=document.createElement("li");o.classList.add("event-item");const a=document.createElement("div");a.classList.add("event-header");const d=document.createElement("h2");d.appendChild(document.createTextNode(e.title)),d.classList.add("event-title");const r=document.createElement("span");r.appendChild(document.createTextNode(dayjs.unix(e.timestamp).format("MMMM D, YYYY HH:mm"))),r.classList.add("event-timestamp");const i=document.createElement("p");i.appendChild(document.createTextNode(e.details)),i.classList.add("event-details"),o.appendChild(a),a.appendChild(d),a.appendChild(r),o.appendChild(i),n.appendChild(o)})}function createNotification(){const e=document.createElement("div");e.classList.add("text","notification","inf");const t=document.createElement("h2");t.appendChild(document.createTextNode("Nothing interesting happened."));const n=document.createElement("p");return n.appendChild(document.createTextNode("Looks like we don't have any data for you on this day.")),e.appendChild(t),e.appendChild(n),e}const body=document.querySelector("body");let isNightmode=body.classList.contains("is-nightmode");const nightmodeToggle=document.querySelector(".night-mode-toggle");function toggleNightmodeOnClick(e){e.preventDefault(),isNightmode=!(isNightmode=body.classList.contains("is-nightmode")),body.classList.toggle("is-nightmode"),localStorage.setItem("nightmode",JSON.stringify(isNightmode))}function turnOnNightmodeOnPageLoad(){"true"===localStorage.getItem("nightmode")&&body.classList.toggle("is-nightmode")}let startDay,endDay;null!==nightmodeToggle&&nightmodeToggle.addEventListener("click",toggleNightmodeOnClick);let dragged=!1;const gridSquares=document.querySelectorAll(".day");function gridStartHandler(e){startDay=e.target.dataset.index,document.querySelectorAll(".today").forEach(function(e,t){e.classList.toggle("today")}),document.querySelectorAll(".select").forEach(function(e,t){e.classList.toggle("select")}),e.target.classList.toggle("today"),dragged=!0}function gridEndHandler(e){e.preventDefault(),endDay=e.target.dataset.index,dragged=!1,startDay>endDay?load(endDay,startDay):load(startDay,endDay)}function gridHoverHandler(e){dragged&&gridSquares.forEach(function(t,n){t.classList.remove("select"),parseInt(startDay)>parseInt(e.target.dataset.index)?parseInt(t.dataset.index)<=parseInt(startDay)&&parseInt(t.dataset.index)>=parseInt(e.target.dataset.index)&&t.classList.add("select"):parseInt(t.dataset.index)>=parseInt(startDay)&&parseInt(t.dataset.index)<=parseInt(e.target.dataset.index)&&t.classList.add("select")})}function removeSpinnerIfPresent(){const e=document.querySelector(".spinner");null!==e&&e.remove()}function removeNotificationIfPresent(){const e=document.querySelector(".notification");null!==e&&e.remove()}function load(e,t){const n={userId:userId,year:year,startDay:e,endDay:t};profile.innerHTML="",removeNotificationIfPresent(),removeSpinnerIfPresent();const o=document.createElement("span");o.classList.add("spinner"),profile.appendChild(o);const a=new XMLHttpRequest;a.open("POST","/api/getData",!0),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.send(JSON.stringify(n)),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&(updateProfile(JSON.parse(a.responseText)),sortProfileTable())}}function sortProfileTable(){const e=document.querySelector(".table table");null!==e&&new Tablesort(e,{descending:!0})}gridSquares.length>0&&gridSquares.forEach(function(e,t){["mousedown","touchstart"].forEach(function(t){e.addEventListener(t,gridStartHandler)}),["mouseup","touchend"].forEach(function(t){e.addEventListener(t,gridEndHandler)}),["mouseenter","touchenter"].forEach(function(t){e.addEventListener(t,gridHoverHandler)})}),getUserId(),getYear(),turnOnNightmodeOnPageLoad(),sortProfileTable();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhYmxlc29ydC5taW4uanMiLCJzY3JpcHQuanMiXSwibmFtZXMiOlsiYSIsImIiLCJjIiwidGhpcyIsInRhZ05hbWUiLCJFcnJvciIsImluaXQiLCJ3aW5kb3ciLCJDdXN0b21FdmVudCIsImRvY3VtZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0Q3VzdG9tRXZlbnQiLCJkIiwiZ2V0QXR0cmlidXRlIiwidGV4dENvbnRlbnQiLCJpbm5lclRleHQiLCJlIiwidHJpbSIsInRvTG93ZXJDYXNlIiwiZiIsInRkIiwiaW5kZXgiLCJleHRlbmQiLCJwdXNoIiwibmFtZSIsInBhdHRlcm4iLCJzb3J0IiwicHJvdG90eXBlIiwiZyIsInRhYmxlIiwidGhlYWQiLCJvcHRpb25zIiwicm93cyIsImxlbmd0aCIsInRIZWFkIiwiaCIsImN1cnJlbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzb3J0VGFibGUiLCJjZWxscyIsInNldEF0dHJpYnV0ZSIsInRhYmluZGV4IiwiYWRkRXZlbnRMaXN0ZW5lciIsImkiLCJjZWxsSW5kZXgiLCJqIiwiayIsImwiLCJtIiwibiIsIm8iLCJkaXNwYXRjaEV2ZW50IiwiZGVzY2VuZGluZyIsInRCb2RpZXMiLCJldmVyeSIsImNvbCIsInAiLCJxIiwiciIsInMiLCJ0IiwidHIiLCJyZXZlcnNlIiwiYXBwZW5kQ2hpbGQiLCJyZWZyZXNoIiwibW9kdWxlIiwiZXhwb3J0cyIsIlRhYmxlc29ydCIsImNsZWFuTnVtYmVyIiwicmVwbGFjZSIsIml0ZW0iLCJtYXRjaCIsInBhcnNlRmxvYXQiLCJpc05hTiIsImNvbXBhcmVOdW1iZXIiLCJwcm9maWxlIiwicXVlcnlTZWxlY3RvciIsInVzZXJJZCIsInllYXIiLCJnZXRVc2VySWQiLCJ1c2VySGVhZGVyIiwiZGF0YXNldCIsImlkIiwiZ2V0WWVhciIsInllYXJIZWFkZXIiLCJ1cGRhdGVQcm9maWxlIiwiZGF0YSIsImNvbnNvbGUiLCJyZW1vdmVTcGlubmVySWZQcmVzZW50IiwibG9ncyIsImV2ZW50cyIsInByaW50TG9ncyIsInByaW50RXZlbnRzIiwibm90aWZpY2F0aW9uIiwiY3JlYXRlTm90aWZpY2F0aW9uIiwibG9nU2VjdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJsb2dUYWJsZSIsImxvZ0hlYWRlciIsImxvZ0hlYWRlclJvdyIsImxvZ0hlYWRlckljb24iLCJsb2dIZWFkZXJMZXZlbCIsImNyZWF0ZVRleHROb2RlIiwibG9nSGVhZGVyRXhwZXJpZW5jZSIsImxvZ0hlYWRlckRpZmZlcmVuY2UiLCJsb2dUYWJsZUJvZHkiLCJmb3JFYWNoIiwibG9nIiwibG9nUm93IiwibG9nSWNvbkNlbGwiLCJsb2dJY29uIiwibG9nTGV2ZWwiLCJsZXZlbCIsImxvZ1ZhbHVlIiwiTWF0aCIsInJvdW5kIiwidmFsdWUiLCJ0b0xvY2FsZVN0cmluZyIsImxvZ0RpZmZlcmVuY2UiLCJkaWZmZXJlbmNlIiwiZXZlbnRTZWN0aW9uIiwiZXZlbnRMaXN0IiwiZXZlbnQiLCJldmVudEl0ZW0iLCJldmVudEhlYWRlciIsImV2ZW50VGl0bGUiLCJ0aXRsZSIsImV2ZW50VGltZXN0YW1wIiwiZGF5anMiLCJ1bml4IiwidGltZXN0YW1wIiwiZm9ybWF0IiwiZXZlbnREZXRhaWxzIiwiZGV0YWlscyIsIm5vdGlmaWNhdGlvblRpdGxlIiwibm90aWZpY2F0aW9uVGV4dCIsImJvZHkiLCJpc05pZ2h0bW9kZSIsImNvbnRhaW5zIiwibmlnaHRtb2RlVG9nZ2xlIiwidG9nZ2xlTmlnaHRtb2RlT25DbGljayIsInByZXZlbnREZWZhdWx0IiwidG9nZ2xlIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0dXJuT25OaWdodG1vZGVPblBhZ2VMb2FkIiwiZ2V0SXRlbSIsInN0YXJ0RGF5IiwiZW5kRGF5IiwiZHJhZ2dlZCIsImdyaWRTcXVhcmVzIiwicXVlcnlTZWxlY3RvckFsbCIsImdyaWRTdGFydEhhbmRsZXIiLCJ0YXJnZXQiLCJzcXVhcmUiLCJncmlkRW5kSGFuZGxlciIsImxvYWQiLCJncmlkSG92ZXJIYW5kbGVyIiwicmVtb3ZlIiwicGFyc2VJbnQiLCJzcGlubmVyIiwicmVtb3ZlTm90aWZpY2F0aW9uSWZQcmVzZW50IiwiaW5uZXJIVE1MIiwibmV3U3Bpbm5lciIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInBhcnNlIiwicmVzcG9uc2VUZXh0Iiwic29ydFByb2ZpbGVUYWJsZSIsInByb2ZpbGVUYWJsZSJdLCJtYXBwaW5ncyI6IkNBSUcsV0FBVyxTQUFTQSxFQUFFQyxFQUFFQyxHQUFHLEtBQUtDLGdCQUFnQkgsR0FBRyxPQUFPLElBQUlBLEVBQUVDLEVBQUVDLEdBQUcsSUFBSUQsR0FBRyxVQUFVQSxFQUFFRyxRQUFRLE1BQU0sSUFBSUMsTUFBTSwyQkFBMkJGLEtBQUtHLEtBQUtMLEVBQUVDLEdBQUcsSUFBSSxJQUFJRCxFQUFFLEdBQUdDLEVBQUUsU0FBU0YsR0FBRyxJQUFJQyxFQUFFLE9BQU9NLE9BQU9DLGFBQWEsbUJBQW1CRCxPQUFPQyxZQUFZUCxFQUFFLElBQUlPLFlBQVlSLElBQUlDLEVBQUVRLFNBQVNDLFlBQVksZ0JBQWlCQyxnQkFBZ0JYLEdBQUUsR0FBRyxPQUFHLEdBQVNDLEdBQUdXLEVBQUUsU0FBU1osR0FBRyxPQUFPQSxFQUFFYSxhQUFhLGNBQWNiLEVBQUVjLGFBQWFkLEVBQUVlLFdBQVcsSUFBSUMsRUFBRSxTQUFTaEIsRUFBRUMsR0FBRyxPQUFPRCxFQUFFQSxFQUFFaUIsT0FBT0Msa0JBQWNqQixFQUFFQSxFQUFFZ0IsT0FBT0MsZUFBb0IsRUFBRWxCLEVBQUVDLEVBQUUsR0FBRyxHQUFHa0IsRUFBRSxTQUFTbkIsRUFBRUMsR0FBRyxPQUFPLFNBQVNDLEVBQUVVLEdBQUcsSUFBSUksRUFBRWhCLEVBQUVFLEVBQUVrQixHQUFHUixFQUFFUSxJQUFJLE9BQU8sSUFBSUosRUFBRWYsRUFBRVcs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QkFDQTdFLHlCQUdBLE1BQU0rRSxFQUFhOUosU0FBU3VGLGNBQWMsUUFDMUN1RSxFQUFXdEUsVUFBVUMsSUFBSSxXQUN6QnZCLFFBQVFaLFlBQVl3RyxHQUdwQixNQUFNQyxFQUFNLElBQUlDLGVBQ2hCRCxFQUFJRSxLQUFLLE9BQVEsZ0JBQWdCLEdBQ2pDRixFQUFJRyxpQkFBaUIsZUFBZ0IsbUNBQ3JDSCxFQUFJSSxLQUFLekIsS0FBS0MsVUFBVTlELElBQ3hCa0YsRUFBSUssbUJBQXFCLFdBQ0UsSUFBbkJMLEVBQUlNLFlBQW1DLE1BQWZOLEVBQUlPLFNBQzVCMUYsY0FBYzhELEtBQUs2QixNQUFNUixFQUFJUyxlQUM3QkMscUJBS1osU0FBU0EsbUJBRUwsTUFBTUMsRUFBZTFLLFNBQVNtRSxjQUFjLGdCQUN2QixPQUFqQnVHLEdBQ0EsSUFBSWhILFVBQVVnSCxFQUFjLENBQ3hCL0gsWUFBWSxJQXJIcEJzRyxZQUFZekgsT0FBUyxHQUVyQnlILFlBQVk5QyxRQUFRLFNBQVVrRCxFQUFRekksR0FFbEMsQ0FBQyxZQUFhLGNBQWN1RixRQUFRLFNBQVU1RixHQUMxQzhJLEVBQU9wSCxpQkFBaUIxQixFQUFHNEksb0JBRy9CLENBQUMsVUFBVyxZQUFZaEQsUUFBUSxTQUFVNUYsR0FDdEM4SSxFQUFPcEgsaUJBQWlCMUIsRUFBRytJLGtCQUcvQixDQUFDLGFBQWMsY0FBY25ELFFBQVEsU0FBVTVGLEdBQzNDOEksRUFBT3BILGlCQUFpQjFCLEVBQUdpSixzQkFxSHZDbEYsWUFDQUksVUFDQWtFLDRCQUNBNkIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIHRhYmxlc29ydCB2NS4wLjIgKDIwMTctMTEtMTIpXG4gKiBodHRwOi8vdHJpc3Rlbi5jYS90YWJsZXNvcnQvZGVtby9cbiAqIENvcHlyaWdodCAoYykgMjAxNyA7IExpY2Vuc2VkIE1JVFxuKi8hZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsYyl7aWYoISh0aGlzIGluc3RhbmNlb2YgYSkpcmV0dXJuIG5ldyBhKGIsYyk7aWYoIWJ8fFwiVEFCTEVcIiE9PWIudGFnTmFtZSl0aHJvdyBuZXcgRXJyb3IoXCJFbGVtZW50IG11c3QgYmUgYSB0YWJsZVwiKTt0aGlzLmluaXQoYixjfHx7fSl9dmFyIGI9W10sYz1mdW5jdGlvbihhKXt2YXIgYjtyZXR1cm4gd2luZG93LkN1c3RvbUV2ZW50JiZcImZ1bmN0aW9uXCI9PXR5cGVvZiB3aW5kb3cuQ3VzdG9tRXZlbnQ/Yj1uZXcgQ3VzdG9tRXZlbnQoYSk6KGI9ZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJDdXN0b21FdmVudFwiKSxiLmluaXRDdXN0b21FdmVudChhLCExLCExLHZvaWQgMCkpLGJ9LGQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGEuZ2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0XCIpfHxhLnRleHRDb250ZW50fHxhLmlubmVyVGV4dHx8XCJcIn0sZT1mdW5jdGlvbihhLGIpe3JldHVybiBhPWEudHJpbSgpLnRvTG93ZXJDYXNlKCksYj1iLnRyaW0oKS50b0xvd2VyQ2FzZSgpLGE9PT1iPzA6YTxiPzE6LTF9LGY9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZnVuY3Rpb24oYyxkKXt2YXIgZT1hKGMudGQsZC50ZCk7cmV0dXJuIDA9PT1lP2I/ZC5pbmRleC1jLmluZGV4OmMuaW5kZXgtZC5pbmRleDplfX07YS5leHRlbmQ9ZnVuY3Rpb24oYSxjLGQpe2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGN8fFwiZnVuY3Rpb25cIiE9dHlwZW9mIGQpdGhyb3cgbmV3IEVycm9yKFwiUGF0dGVybiBhbmQgc29ydCBtdXN0IGJlIGEgZnVuY3Rpb25cIik7Yi5wdXNoKHtuYW1lOmEscGF0dGVybjpjLHNvcnQ6ZH0pfSxhLnByb3RvdHlwZT17aW5pdDpmdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmLGc9dGhpcztpZihnLnRhYmxlPWEsZy50aGVhZD0hMSxnLm9wdGlvbnM9YixhLnJvd3MmJmEucm93cy5sZW5ndGg+MClpZihhLnRIZWFkJiZhLnRIZWFkLnJvd3MubGVuZ3RoPjApe2ZvcihlPTA7ZTxhLnRIZWFkLnJvd3MubGVuZ3RoO2UrKylpZihcInRoZWFkXCI9PT1hLnRIZWFkLnJvd3NbZV0uZ2V0QXR0cmlidXRlKFwiZGF0YS1zb3J0LW1ldGhvZFwiKSl7Yz1hLnRIZWFkLnJvd3NbZV07YnJlYWt9Y3x8KGM9YS50SGVhZC5yb3dzW2EudEhlYWQucm93cy5sZW5ndGgtMV0pLGcudGhlYWQ9ITB9ZWxzZSBjPWEucm93c1swXTtpZihjKXt2YXIgaD1mdW5jdGlvbigpe2cuY3VycmVudCYmZy5jdXJyZW50IT09dGhpcyYmZy5jdXJyZW50LnJlbW92ZUF0dHJpYnV0ZShcImFyaWEtc29ydFwiKSxnLmN1cnJlbnQ9dGhpcyxnLnNvcnRUYWJsZSh0aGlzKX07Zm9yKGU9MDtlPGMuY2VsbHMubGVuZ3RoO2UrKylmPWMuY2VsbHNbZV0sZi5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsXCJjb2x1bW5oZWFkZXJcIiksXCJub25lXCIhPT1mLmdldEF0dHJpYnV0ZShcImRhdGEtc29ydC1tZXRob2RcIikmJihmLnRhYmluZGV4PTAsZi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIixoLCExKSxudWxsIT09Zi5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnQtZGVmYXVsdFwiKSYmKGQ9ZikpO2QmJihnLmN1cnJlbnQ9ZCxnLnNvcnRUYWJsZShkKSl9fSxzb3J0VGFibGU6ZnVuY3Rpb24oYSxnKXt2YXIgaD10aGlzLGk9YS5jZWxsSW5kZXgsaj1lLGs9XCJcIixsPVtdLG09aC50aGVhZD8wOjEsbj1hLmdldEF0dHJpYnV0ZShcImRhdGEtc29ydC1tZXRob2RcIiksbz1hLmdldEF0dHJpYnV0ZShcImFyaWEtc29ydFwiKTtpZihoLnRhYmxlLmRpc3BhdGNoRXZlbnQoYyhcImJlZm9yZVNvcnRcIikpLGd8fChvPVwiYXNjZW5kaW5nXCI9PT1vP1wiZGVzY2VuZGluZ1wiOlwiZGVzY2VuZGluZ1wiPT09bz9cImFzY2VuZGluZ1wiOmgub3B0aW9ucy5kZXNjZW5kaW5nP1wiZGVzY2VuZGluZ1wiOlwiYXNjZW5kaW5nXCIsYS5zZXRBdHRyaWJ1dGUoXCJhcmlhLXNvcnRcIixvKSksIShoLnRhYmxlLnJvd3MubGVuZ3RoPDIpKXtpZighbil7Zm9yKDtsLmxlbmd0aDwzJiZtPGgudGFibGUudEJvZGllc1swXS5yb3dzLmxlbmd0aDspaz1kKGgudGFibGUudEJvZGllc1swXS5yb3dzW21dLmNlbGxzW2ldKSxrPWsudHJpbSgpLGsubGVuZ3RoPjAmJmwucHVzaChrKSxtKys7aWYoIWwpcmV0dXJufWZvcihtPTA7bTxiLmxlbmd0aDttKyspaWYoaz1iW21dLG4pe2lmKGsubmFtZT09PW4pe2o9ay5zb3J0O2JyZWFrfX1lbHNlIGlmKGwuZXZlcnkoay5wYXR0ZXJuKSl7aj1rLnNvcnQ7YnJlYWt9Zm9yKGguY29sPWksbT0wO208aC50YWJsZS50Qm9kaWVzLmxlbmd0aDttKyspe3ZhciBwLHE9W10scj17fSxzPTAsdD0wO2lmKCEoaC50YWJsZS50Qm9kaWVzW21dLnJvd3MubGVuZ3RoPDIpKXtmb3IocD0wO3A8aC50YWJsZS50Qm9kaWVzW21dLnJvd3MubGVuZ3RoO3ArKylrPWgudGFibGUudEJvZGllc1ttXS5yb3dzW3BdLFwibm9uZVwiPT09ay5nZXRBdHRyaWJ1dGUoXCJkYXRhLXNvcnQtbWV0aG9kXCIpP3Jbc109azpxLnB1c2goe3RyOmssdGQ6ZChrLmNlbGxzW2guY29sXSksaW5kZXg6c30pLHMrKztmb3IoXCJkZXNjZW5kaW5nXCI9PT1vP3Euc29ydChmKGosITApKToocS5zb3J0KGYoaiwhMSkpLHEucmV2ZXJzZSgpKSxwPTA7cDxzO3ArKylyW3BdPyhrPXJbcF0sdCsrKTprPXFbcC10XS50cixoLnRhYmxlLnRCb2RpZXNbbV0uYXBwZW5kQ2hpbGQoayl9fWgudGFibGUuZGlzcGF0Y2hFdmVudChjKFwiYWZ0ZXJTb3J0XCIpKX19LHJlZnJlc2g6ZnVuY3Rpb24oKXt2b2lkIDAhPT10aGlzLmN1cnJlbnQmJnRoaXMuc29ydFRhYmxlKHRoaXMuY3VycmVudCwhMCl9fSxcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1hOndpbmRvdy5UYWJsZXNvcnQ9YX0oKTtcblxuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNsZWFuTnVtYmVyID0gZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgcmV0dXJuIGkucmVwbGFjZSgvW15cXC0/MC05Ll0vZywgJycpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbXBhcmVOdW1iZXIgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICBhID0gcGFyc2VGbG9hdChhKTtcbiAgICAgICAgICAgIGIgPSBwYXJzZUZsb2F0KGIpO1xuXG4gICAgICAgICAgICBhID0gaXNOYU4oYSkgPyAwIDogYTtcbiAgICAgICAgICAgIGIgPSBpc05hTihiKSA/IDAgOiBiO1xuXG4gICAgICAgICAgICByZXR1cm4gYSAtIGI7XG4gICAgICAgIH07XG5cbiAgICBUYWJsZXNvcnQuZXh0ZW5kKCdudW1iZXInLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtLm1hdGNoKC9eWy0rXT9bwqNcXHgyNMObwqLCtOKCrF0/XFxkK1xccyooWyxcXC5dXFxkezAsMn0pLykgfHwgLy8gUHJlZml4ZWQgY3VycmVuY3lcbiAgICAgICAgICAgIGl0ZW0ubWF0Y2goL15bLStdP1xcZCtcXHMqKFssXFwuXVxcZHswLDJ9KT9bwqNcXHgyNMObwqLCtOKCrF0vKSB8fCAvLyBTdWZmaXhlZCBjdXJyZW5jeVxuICAgICAgICAgICAgaXRlbS5tYXRjaCgvXlstK10/KFxcZCkqLT8oWyxcXC5dKXswLDF9LT8oXFxkKSsoW0UsZV1bXFwtK11bXFxkXSspPyU/JC8pOyAvLyBOdW1iZXJcbiAgICB9LCBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIGEgPSBjbGVhbk51bWJlcihhKTtcbiAgICAgICAgYiA9IGNsZWFuTnVtYmVyKGIpO1xuXG4gICAgICAgIHJldHVybiBjb21wYXJlTnVtYmVyKGIsIGEpO1xuICAgIH0pO1xufSgpKTsiLCIvKlxuICogUnVuZWxvZ3Mgc2NyaXB0LmpzXG4gKlxuICogQ29udGVudDpcbiAqICAtIEdldCB1c2VySWQgYW5kIGN1cnJlbnQgeWVhciBmcm9tIHRoZSBhcHByb3ByaWF0ZSBoZWFkZXJzXG4gKiAgLSBHcmlkIHNxdWFyZSBjbGljayBldmVudCAtPiBYaFIgcmVxdWVzdCBuYWFyIEFQSSAtPiB1cGRhdGUgcHJvZmlsZVxuICogIC0gTmlnaHRtb2RlIHRvZ2dsZSAod29ya3Mgd2l0aCBsb2NhbFN0b3JhZ2UpXG4gKiAgLSBHcmlkIGRyYWcgLT4gc2VsZWN0IHNxdWFyZXNcbiAqICAtIFByaW50IGEgdGFibGUgd2l0aCByb3dzIGZvciBleHAgb3IgYW4gdW5vcmRlbmVkIGxvc3QgZm9yIGV2ZW50c1xuICpcbiAqL1xuXG5jb25zdCBwcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGUnKTtcbmxldCB1c2VySWQgPSBudWxsO1xubGV0IHllYXIgPSBudWxsO1xuXG5mdW5jdGlvbiBnZXRVc2VySWQoKSB7XG4gICAgY29uc3QgdXNlckhlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jdXJyZW50IGgxJyk7XG4gICAgaWYgKHVzZXJIZWFkZXIgIT09IG51bGwpIHtcbiAgICAgICAgdXNlcklkID0gdXNlckhlYWRlci5kYXRhc2V0LmlkO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0WWVhcigpIHtcbiAgICBjb25zdCB5ZWFySGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnllYXJIZWFkZXInKTtcbiAgICBpZiAoeWVhckhlYWRlciAhPT0gbnVsbCkge1xuICAgICAgICB5ZWFyID0geWVhckhlYWRlci5kYXRhc2V0LnllYXI7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVQcm9maWxlKGRhdGEpXG57XG4gICAgY29uc29sZS50YWJsZShkYXRhKTtcbiAgICByZW1vdmVTcGlubmVySWZQcmVzZW50KCk7XG5cbiAgICBpZiAoZGF0YS5sb2dzICA9PT0gbnVsbCAmJiBkYXRhLmV2ZW50cy5sZW5ndGggID09PSAwKSB7XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGNyZWF0ZU5vdGlmaWNhdGlvbigpO1xuICAgICAgICBwcm9maWxlLmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvbik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5sb2dzICAhPT0gbnVsbCkge1xuICAgICAgICBwcmludExvZ3MoZGF0YS5sb2dzKTtcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5ldmVudHMubGVuZ3RoICAhPT0gMCkge1xuICAgICAgICBwcmludEV2ZW50cyhkYXRhLmV2ZW50cyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwcmludExvZ3MobG9ncylcbntcbiAgICAvLyBQcmludCB0aGUgZXhwZXJpZW5jZSB0YWJsZSBhbmQgaGVhZGVyXG4gICAgY29uc3QgbG9nU2VjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlY3Rpb24nKTtcbiAgICBsb2dTZWN0aW9uLmNsYXNzTGlzdC5hZGQoJ3RhYmxlJyk7XG5cbiAgICBjb25zdCBsb2dUYWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG4gICAgY29uc3QgbG9nSGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKTtcblxuICAgIGNvbnN0IGxvZ0hlYWRlclJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBsb2dIZWFkZXJJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICBsb2dIZWFkZXJJY29uLmNsYXNzTGlzdC5hZGQoJ2ljb24nKTtcblxuICAgIGNvbnN0IGxvZ0hlYWRlckxldmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICBsb2dIZWFkZXJMZXZlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTGV2ZWwnKSk7XG4gICAgbG9nSGVhZGVyTGV2ZWwuY2xhc3NMaXN0LmFkZCgnbGV2ZWwnKTtcblxuICAgIGNvbnN0IGxvZ0hlYWRlckV4cGVyaWVuY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xuICAgIGxvZ0hlYWRlckV4cGVyaWVuY2UuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0V4cGVyaWVuY2UnKSk7XG5cbiAgICBjb25zdCBsb2dIZWFkZXJEaWZmZXJlbmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICBsb2dIZWFkZXJEaWZmZXJlbmNlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdEaWZmZXJlbmNlJykpO1xuXG4gICAgY29uc3QgbG9nVGFibGVCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTtcblxuICAgIHByb2ZpbGUuYXBwZW5kQ2hpbGQobG9nU2VjdGlvbik7XG4gICAgbG9nU2VjdGlvbi5hcHBlbmRDaGlsZChsb2dUYWJsZSk7XG4gICAgbG9nVGFibGUuYXBwZW5kQ2hpbGQobG9nSGVhZGVyKTtcblxuICAgIGxvZ0hlYWRlclJvdy5hcHBlbmRDaGlsZChsb2dIZWFkZXJJY29uKTtcbiAgICBsb2dIZWFkZXJSb3cuYXBwZW5kQ2hpbGQobG9nSGVhZGVyTGV2ZWwpO1xuICAgIGxvZ0hlYWRlclJvdy5hcHBlbmRDaGlsZChsb2dIZWFkZXJFeHBlcmllbmNlKTtcbiAgICBsb2dIZWFkZXJSb3cuYXBwZW5kQ2hpbGQobG9nSGVhZGVyRGlmZmVyZW5jZSk7XG5cbiAgICBsb2dIZWFkZXIuYXBwZW5kQ2hpbGQobG9nSGVhZGVyUm93KTtcblxuICAgIGxvZ1RhYmxlLmFwcGVuZENoaWxkKGxvZ1RhYmxlQm9keSk7XG5cbiAgICAvKiBEaXNwbGF5IHRoZSBleHBlcmllbmNlIHRhYmxlIHJvd3MgKi9cbiAgICBsb2dzLmZvckVhY2goZnVuY3Rpb24gKGxvZywgaW5kZXgpIHtcbiAgICAgICAgY29uc3QgbG9nUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgICAgICBjb25zdCBsb2dJY29uQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICAgIGNvbnN0IGxvZ0ljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIGxvZ0ljb24uY2xhc3NMaXN0LmFkZCgnbG9nLWljb24nLCAncycgKyBpbmRleCk7XG4gICAgICAgIGxvZ0ljb25DZWxsLmFwcGVuZENoaWxkKGxvZ0ljb24pO1xuXG4gICAgICAgIGNvbnN0IGxvZ0xldmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgICAgbG9nTGV2ZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobG9nLmxldmVsKSk7XG5cbiAgICAgICAgY29uc3QgbG9nVmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICBsb2dWYWx1ZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShNYXRoLnJvdW5kKGxvZy52YWx1ZSkudG9Mb2NhbGVTdHJpbmcoKSkpO1xuXG4gICAgICAgIGNvbnN0IGxvZ0RpZmZlcmVuY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgICBpZiAobG9nLmRpZmZlcmVuY2UgPiAwKSB7XG4gICAgICAgICAgICBsb2dEaWZmZXJlbmNlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcrJyArIE1hdGgucm91bmQobG9nLmRpZmZlcmVuY2UpLnRvTG9jYWxlU3RyaW5nKCkpKTtcbiAgICAgICAgICAgIGxvZ0RpZmZlcmVuY2UuY2xhc3NMaXN0LmFkZCgnbG9nLXZhbHVlJywgJ3Bvc2l0aXZlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dEaWZmZXJlbmNlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcwJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9nUm93LmFwcGVuZENoaWxkKGxvZ0ljb25DZWxsKTtcbiAgICAgICAgbG9nUm93LmFwcGVuZENoaWxkKGxvZ0xldmVsKTtcbiAgICAgICAgbG9nUm93LmFwcGVuZENoaWxkKGxvZ1ZhbHVlKTtcbiAgICAgICAgbG9nUm93LmFwcGVuZENoaWxkKGxvZ0RpZmZlcmVuY2UpO1xuICAgICAgICBsb2dUYWJsZUJvZHkuYXBwZW5kQ2hpbGQobG9nUm93KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gcHJpbnRFdmVudHMoZXZlbnRzKVxue1xuICAgIGNvbnN0IGV2ZW50U2VjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlY3Rpb24nKTtcbiAgICBldmVudFNlY3Rpb24uY2xhc3NMaXN0LmFkZCgnZXZlbnRzJyk7XG5cbiAgICBjb25zdCBldmVudExpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuICAgIGV2ZW50TGlzdC5jbGFzc0xpc3QuYWRkKCdldmVudHMnKTtcblxuICAgIHByb2ZpbGUuYXBwZW5kQ2hpbGQoZXZlbnRTZWN0aW9uKTtcbiAgICBldmVudFNlY3Rpb24uYXBwZW5kQ2hpbGQoZXZlbnRMaXN0KTtcblxuICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCwgaW5kZXgpIHtcblxuICAgICAgICBjb25zdCBldmVudEl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgICBldmVudEl0ZW0uY2xhc3NMaXN0LmFkZCgnZXZlbnQtaXRlbScpO1xuXG4gICAgICAgIGNvbnN0IGV2ZW50SGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGV2ZW50SGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2V2ZW50LWhlYWRlcicpO1xuXG4gICAgICAgIGNvbnN0IGV2ZW50VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgICAgICBldmVudFRpdGxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGV2ZW50LnRpdGxlKSk7XG4gICAgICAgIGV2ZW50VGl0bGUuY2xhc3NMaXN0LmFkZCgnZXZlbnQtdGl0bGUnKTtcblxuICAgICAgICBjb25zdCBldmVudFRpbWVzdGFtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgZXZlbnRUaW1lc3RhbXAuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF5anMudW5peChldmVudC50aW1lc3RhbXApLmZvcm1hdChcIk1NTU0gRCwgWVlZWSBISDptbVwiKSkpO1xuICAgICAgICBldmVudFRpbWVzdGFtcC5jbGFzc0xpc3QuYWRkKCdldmVudC10aW1lc3RhbXAnKTtcblxuICAgICAgICBjb25zdCBldmVudERldGFpbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICAgIGV2ZW50RGV0YWlscy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShldmVudC5kZXRhaWxzKSk7XG4gICAgICAgIGV2ZW50RGV0YWlscy5jbGFzc0xpc3QuYWRkKCdldmVudC1kZXRhaWxzJyk7XG5cbiAgICAgICAgZXZlbnRJdGVtLmFwcGVuZENoaWxkKGV2ZW50SGVhZGVyKTtcbiAgICAgICAgZXZlbnRIZWFkZXIuYXBwZW5kQ2hpbGQoZXZlbnRUaXRsZSk7XG4gICAgICAgIGV2ZW50SGVhZGVyLmFwcGVuZENoaWxkKGV2ZW50VGltZXN0YW1wKTtcbiAgICAgICAgZXZlbnRJdGVtLmFwcGVuZENoaWxkKGV2ZW50RGV0YWlscyk7XG5cbiAgICAgICAgZXZlbnRMaXN0LmFwcGVuZENoaWxkKGV2ZW50SXRlbSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU5vdGlmaWNhdGlvbigpXG57XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgbm90aWZpY2F0aW9uLmNsYXNzTGlzdC5hZGQoJ3RleHQnLCAnbm90aWZpY2F0aW9uJywgJ2luZicpO1xuXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgIG5vdGlmaWNhdGlvblRpdGxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiTm90aGluZyBpbnRlcmVzdGluZyBoYXBwZW5lZC5cIikpO1xuXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub3RpZmljYXRpb25UZXh0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwiTG9va3MgbGlrZSB3ZSBkb24ndCBoYXZlIGFueSBkYXRhIGZvciB5b3Ugb24gdGhpcyBkYXkuXCIpKTtcblxuICAgIG5vdGlmaWNhdGlvbi5hcHBlbmRDaGlsZChub3RpZmljYXRpb25UaXRsZSk7XG4gICAgbm90aWZpY2F0aW9uLmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvblRleHQpO1xuICAgIHJldHVybiBub3RpZmljYXRpb247XG59XG5cbi8qIE5pZ2h0bW9kZSB0b2dnbGUgKGdsb2JhbCkgKi9cblxuY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbmxldCBpc05pZ2h0bW9kZSA9IGJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1uaWdodG1vZGUnKTtcbmNvbnN0IG5pZ2h0bW9kZVRvZ2dsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uaWdodC1tb2RlLXRvZ2dsZScpO1xuXG5mdW5jdGlvbiB0b2dnbGVOaWdodG1vZGVPbkNsaWNrKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAvLyBHZXQgdGhlIGJvZHkgY2xhc3MgYW5kIHJldmVyc2UgaXRcbiAgICBpc05pZ2h0bW9kZSA9IGJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1uaWdodG1vZGUnKTtcbiAgICBpc05pZ2h0bW9kZSA9ICFpc05pZ2h0bW9kZTtcblxuICAgIC8vIFNldCB0aGUgYm9keSBjbGFzcyBzbyB0aGF0IHRoZSBzdHlsaW5nIGNoYW5nZXNcbiAgICBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2lzLW5pZ2h0bW9kZScpO1xuXG4gICAgLy8gU3RvcmUgdGhlIGJvb2wgaW4gbG9jYWxTdG9yYWdlXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJuaWdodG1vZGVcIiwgSlNPTi5zdHJpbmdpZnkoaXNOaWdodG1vZGUpKTtcbn1cblxuLypcbiAqIElmIGEgcGFnZSBpcyBsb2FkZWQgYW5kIHRoZSBsb2NhbFN0b3JhZ2UgcGFyYW1ldGVyIGlzIHNldCB0b1xuICogdHJ1ZSwgdGhlbiBzd2l0Y2ggdGhlIHBhZ2Ugc3R5bGluZ1xuICovXG5mdW5jdGlvbiB0dXJuT25OaWdodG1vZGVPblBhZ2VMb2FkKCkge1xuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIm5pZ2h0bW9kZVwiKSA9PT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1uaWdodG1vZGUnKTtcbiAgICB9XG59XG5cbmlmIChuaWdodG1vZGVUb2dnbGUgIT09IG51bGwpIHtcbiAgICBuaWdodG1vZGVUb2dnbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVOaWdodG1vZGVPbkNsaWNrKTtcbn1cblxuLyogRGF0ZSBjbGlja2VyICovXG5sZXQgc3RhcnREYXksIGVuZERheTtcbmxldCBkcmFnZ2VkID0gZmFsc2U7XG5cbi8qIFNWRyBHcmlkIGV2ZW50cyAqL1xuY29uc3QgZ3JpZFNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGF5Jyk7XG5cbi8vIHF1ZXJ5U2VsZWN0b3JBbGwgcmV0dXJucyBhIE5vZGVsaXN0IHNvIGhhdmUgdG8gY2hlY2sgZm9yIGxlbmd0aFxuaWYgKGdyaWRTcXVhcmVzLmxlbmd0aCA+IDApIHtcblxuICAgIGdyaWRTcXVhcmVzLmZvckVhY2goZnVuY3Rpb24gKHNxdWFyZSwgaW5kZXgpIHtcblxuICAgICAgICBbJ21vdXNlZG93bicsICd0b3VjaHN0YXJ0J10uZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoZSwgZ3JpZFN0YXJ0SGFuZGxlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIFsnbW91c2V1cCcsICd0b3VjaGVuZCddLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKGUsIGdyaWRFbmRIYW5kbGVyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgWydtb3VzZWVudGVyJywgJ3RvdWNoZW50ZXInXS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihlLCBncmlkSG92ZXJIYW5kbGVyKTtcbiAgICAgICAgfSk7XG5cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZ3JpZFN0YXJ0SGFuZGxlcihlKSB7XG4gICAgc3RhcnREYXkgPSBlLnRhcmdldC5kYXRhc2V0LmluZGV4O1xuXG4gICAgY29uc3QgYWN0aXZlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvZGF5Jyk7XG4gICAgYWN0aXZlLmZvckVhY2goZnVuY3Rpb24gKHNxdWFyZSwgaW5kZXgpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC50b2dnbGUoJ3RvZGF5Jyk7XG4gICAgfSlcbiAgICBjb25zdCBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWxlY3QnKTtcbiAgICBzZWxlY3RlZC5mb3JFYWNoKGZ1bmN0aW9uIChzcXVhcmUsIGluZGV4KSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QudG9nZ2xlKCdzZWxlY3QnKTtcbiAgICB9KVxuICAgIGUudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoJ3RvZGF5Jyk7XG4gICAgZHJhZ2dlZCA9IHRydWU7XG59XG5cbmZ1bmN0aW9uIGdyaWRFbmRIYW5kbGVyKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZW5kRGF5ID0gZS50YXJnZXQuZGF0YXNldC5pbmRleDtcbiAgICBkcmFnZ2VkID0gZmFsc2U7XG4gICAgaWYgKHN0YXJ0RGF5ID4gZW5kRGF5KSB7XG4gICAgICAgIGxvYWQoZW5kRGF5LCBzdGFydERheSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbG9hZChzdGFydERheSwgZW5kRGF5KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdyaWRIb3ZlckhhbmRsZXIoZSkge1xuICAgIGlmIChkcmFnZ2VkKSB7XG4gICAgICAgIGdyaWRTcXVhcmVzLmZvckVhY2goZnVuY3Rpb24gKHNxdWFyZSwgaW5kZXgpIHtcbiAgICAgICAgICAgIC8vcmVzZXRcbiAgICAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3QnKTtcbiAgICAgICAgICAgIC8vcmlnaHQgZHJhZ1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KHN0YXJ0RGF5KSA+IHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQuaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmluZGV4KSA8PSBwYXJzZUludChzdGFydERheSkgJiYgcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQuaW5kZXgpID49IHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQuaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdzZWxlY3QnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vbGVmdCBkcmFnXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmluZGV4KSA+PSBwYXJzZUludChzdGFydERheSkgJiYgcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQuaW5kZXgpIDw9IHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQuaW5kZXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdzZWxlY3QnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVTcGlubmVySWZQcmVzZW50KCkge1xuICAgIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Bpbm5lcicpO1xuICAgIGlmIChzcGlubmVyICE9PSBudWxsKSB7XG4gICAgICAgIHNwaW5uZXIucmVtb3ZlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVOb3RpZmljYXRpb25JZlByZXNlbnQoKSB7XG4gICAgY29uc3Qgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vdGlmaWNhdGlvbicpO1xuICAgIGlmIChub3RpZmljYXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgbm90aWZpY2F0aW9uLnJlbW92ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbG9hZChzdGFydERheSwgZW5kRGF5KSB7XG5cbiAgICAvLyAgUHJlcCB0aGUgZGF0YSB0aGF0IHRoZSBBUEkgbmVlZHNcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICB1c2VySWQ6IHVzZXJJZCxcbiAgICAgICAgeWVhcjogeWVhcixcbiAgICAgICAgc3RhcnREYXk6IHN0YXJ0RGF5LFxuICAgICAgICBlbmREYXk6IGVuZERheVxuICAgIH07XG5cbiAgICAvLyAgQ2xlYW4gdXAgdGhlIHByb2ZpbGUgc28gd2UgY2FuIHJlLWluc2VydCB0aGUgbmV3IGRhdGFcbiAgICBwcm9maWxlLmlubmVySFRNTCA9ICcnO1xuICAgIHJlbW92ZU5vdGlmaWNhdGlvbklmUHJlc2VudCgpO1xuICAgIHJlbW92ZVNwaW5uZXJJZlByZXNlbnQoKTtcblxuICAgIC8vICBBZGQgdGhlIGxvYWRpbmcgc3Bpbm5lclxuICAgIGNvbnN0IG5ld1NwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgbmV3U3Bpbm5lci5jbGFzc0xpc3QuYWRkKCdzcGlubmVyJyk7XG4gICAgcHJvZmlsZS5hcHBlbmRDaGlsZChuZXdTcGlubmVyKTtcblxuICAgIC8vICBTdGFydCB0aGUgcmVxdWVzdFxuICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIHhoci5vcGVuKCdQT1NUJywgJy9hcGkvZ2V0RGF0YScsIHRydWUpO1xuICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCcpO1xuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgJiYgeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICB1cGRhdGVQcm9maWxlKEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCkpO1xuICAgICAgICAgICAgc29ydFByb2ZpbGVUYWJsZSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzb3J0UHJvZmlsZVRhYmxlKClcbntcbiAgICBjb25zdCBwcm9maWxlVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFibGUgdGFibGUnKTtcbiAgICBpZiAocHJvZmlsZVRhYmxlICE9PSBudWxsKSB7XG4gICAgICAgIG5ldyBUYWJsZXNvcnQocHJvZmlsZVRhYmxlLCB7XG4gICAgICAgICAgICBkZXNjZW5kaW5nOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLypcbmxldCBncmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdyaWQtY29udGFpbmVyJyk7XG5pZihncmlkKXtcbiAgbGV0IG1heCA9IGdyaWQuc2Nyb2xsV2lkdGggLSBncmlkLmNsaWVudFdpZHRoO1xuICBncmlkLnNjcm9sbExlZnQgPSBtYXg7XG59XG4qL1xuXG5nZXRVc2VySWQoKTtcbmdldFllYXIoKTtcbnR1cm5Pbk5pZ2h0bW9kZU9uUGFnZUxvYWQoKTtcbnNvcnRQcm9maWxlVGFibGUoKTsiXX0=